<template>
    <div class="home-container">
      <div ref="gradient" class="gradient"></div>
      <svg width="89" height="44" viewBox="0 0 89 44" fill="none" xmlns="http://www.w3.org/2000/svg" class="logo">
        <rect width="88.4325" height="43.0469" rx="21.5235" fill="black"/>
        <path d="M73.4325 16.3495C73.4325 19.9342 70.6603 21.9178 67.1951 22.109L69.7044 28.6093C70.2062 29.8998 71.3534 29.8998 71.9269 29.9476L71.6401 31.0469H67.0756L63.5864 22.1568H62.0569L60.5036 28.2269C60.4319 28.4659 60.408 28.681 60.408 28.8722C60.408 30.0193 61.6029 29.8998 62.1764 29.9715L61.9613 31.0469H54.0988L54.4095 29.9715C54.9592 29.9476 56.5842 29.8042 57.0861 27.7967L60.1212 15.6325C60.1929 15.3696 60.2168 15.1307 60.2168 14.9395C60.2168 13.649 58.998 13.5534 58.4722 13.5534L58.7351 12.4063H66.5737C70.6842 12.4063 73.4325 13.5534 73.4325 16.3495ZM69.7522 16.4451C69.7522 14.7483 68.1271 14.3181 65.8807 14.3181H64.0166L62.5827 20.1971H64.8769C67.8881 20.1971 69.7522 18.8349 69.7522 16.4451Z" fill="white"/>
        <path d="M56.1251 12.4063L56.866 17.1142L55.6472 17.3771L54.8585 15.5369C54.4523 14.581 53.5919 14.0074 51.919 14.0074H48.2148C47.2589 14.0074 46.8526 14.3898 46.5897 15.3935L45.347 20.2688H49.5053C51.3455 20.2688 51.704 19.4085 51.8712 19.05L52.2058 18.3091H53.4963L51.9668 24.2359H50.6763C50.7241 23.973 50.7958 23.5906 50.7958 23.2561C50.7958 22.6108 50.5568 22.0134 49.5531 22.0134H44.893L43.244 28.4898C43.1962 28.6571 43.1723 28.7766 43.1723 28.8961C43.1723 29.374 43.5308 29.5174 44.2955 29.5174H47.6413C50.2701 29.5174 51.7996 28.1552 52.5882 27.3427L54.2133 25.6459L55.0019 26.2195L51.7279 31.0469H36.887L37.1738 29.8998C38.1298 29.8281 39.3486 29.852 39.8026 28.0118L43.005 15.2502C43.0528 15.0351 43.0767 14.8439 43.0767 14.6766C43.0767 13.5534 41.9296 13.6251 41.3799 13.5534L41.5711 12.4063H56.1251Z" fill="white"/>
        <path d="M32.4569 12.4063H40.1282L39.8176 13.5534C39.1484 13.649 38.2403 13.888 36.7347 15.0351L30.0671 20.1015L34.775 28.6571C35.3486 29.6847 36.9737 29.8998 37.6189 29.9476L37.4038 31.0469H28.5137L28.7527 29.9715C29.4218 29.9476 30.8318 29.9715 30.8318 28.9439C30.8318 28.6571 30.7123 28.2747 30.4733 27.8206L27.3666 22.0851L25.8371 23.2561L24.69 27.8684C24.5944 28.203 24.5705 28.4898 24.5705 28.7288C24.5705 30.0193 25.6459 29.9237 26.3151 29.9954L26.1 31.0469H18.2852L18.5003 29.9476C19.289 29.8998 20.7229 29.7325 21.2247 27.7728L24.2598 15.6803C24.2837 15.5369 24.3076 15.4174 24.3076 15.2741C24.3076 13.7924 21.9417 13.649 20.3405 13.649H19.3846C16.3256 13.6729 13.9597 15.2741 13.9597 18.5242C13.9597 19.8625 14.82 21.6071 16.3973 21.6071C17.6639 21.6071 17.6161 20.5317 17.7356 19.5996C17.879 18.5003 18.6198 17.2815 19.9581 17.2815C20.8663 17.2815 21.4398 18.1419 21.4398 19.0022C21.4398 21.2725 19.2651 23.2083 16.7558 23.2083C13.9836 23.2083 12 21.3203 12 18.5959C12 14.581 15.0351 12 19.1695 12C22.2285 12 24.5705 12.4063 27.6534 12.4063H30.7601L30.4733 13.5534C29.5174 13.649 28.2508 13.8163 27.8206 15.5847L26.6018 20.6034L33.15 15.6086C33.6996 15.2024 33.8908 14.8439 33.8908 14.581C33.8908 13.9358 32.8393 13.6251 32.2179 13.5534L32.4569 12.4063Z" fill="white"/>
      </svg>
      <div class="container-title">
        <h1>Gère tes</h1>
        <h1>invitations pour</h1>
        <div class="line-carousel">
          <div class="hiddenText">
            <div ref="slider" class="pastille-container">
              <div class="pastille">ta crémaillère</div>
              <div class="pastille">ton anniversaire</div>
              <div class="pastille">halloween</div>
              <div class="pastille">la première raclette</div>
              <div class="pastille">ton réveillon</div>
              <div class="pastille">ta crémaillère</div>
            </div>
          </div>
        </div>
      </div>
      <p class="indication">Juste comme ça.</p>
      <div class="create-event-container">
        <button class="btn-create-event" @click="createEvent">Créer un évènement</button>
        <a href="javascript:void(0);" @click="showEmailInput">ou retrouve tes évènements déjà créés</a>
      </div>
  
      <div class="email-retrieve-container" ref="containerEmail">
        <button class="exit" @click="hideEmailInput">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M16.773 8.28769L8.28771 16.773C7.99779 17.0629 7.51696 17.0629 7.22705 16.773C6.93713 16.4831 6.93713 16.0022 7.22705 15.7123L15.7123 7.22703C16.0022 6.93711 16.4831 6.93711 16.773 7.22703C17.0629 7.51694 17.0629 7.99777 16.773 8.28769Z" fill="#A8ACB7"/>
            <path d="M16.773 16.773C16.4831 17.0629 16.0022 17.0629 15.7123 16.773L7.22705 8.28769C6.93713 7.99778 6.93713 7.51695 7.22705 7.22703C7.51696 6.93712 7.99779 6.93712 8.28771 7.22703L16.773 15.7123C17.0629 16.0022 17.0629 16.4831 16.773 16.773Z" fill="#A8ACB7"/>
          </svg>
        </button>
        <p>Il nous faut ton email pour retrouver tes évènements</p>
        <div class="input-container">
          <input type="email" v-model="email" id="email" placeholder="exemple@mail.com" class="email-input" />
          <button class="retrieve-events-button" @click="findEvents">
            <svg width="44" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14.2333 17.7792C14.36 17.7792 14.4867 17.7325 14.5867 17.6325C14.78 17.4392 14.78 17.1192 14.5867 16.9258L10.24 12.5792C9.91999 12.2592 9.91999 11.7392 10.24 11.4192L14.5867 7.0725C14.78 6.87917 14.78 6.55917 14.5867 6.36583C14.3933 6.1725 14.0733 6.1725 13.88 6.36583L9.53333 10.7125C9.19333 11.0525 8.99999 11.5125 8.99999 11.9992C8.99999 12.4858 9.18666 12.9458 9.53333 13.2858L13.88 17.6325C13.98 17.7258 14.1067 17.7792 14.2333 17.7792Z" fill="#FFFFFF"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </template>
  
  <script setup >
    import { ref, onMounted, onBeforeUnmount } from 'vue';
    import { useUserStore } from '../stores/userStore';
    import { useFormGuestStore } from '../stores/formGuestStore';
    import { useRouter } from 'vue-router';
    import { gsap} from 'gsap';


    const router = useRouter();
    const userStore = useUserStore();
    const formGuestStore = useFormGuestStore();
    const email = ref('');
    const slider = ref(null);
    const gradient = ref(null);
    const containerEmail = ref(null);

    const findEvents = () => {
      if (email.value) {
        userStore.updateEmail(email.value); // On sauvegarde l'email dans le store
        formGuestStore.updateEmail(email.value);
        router.push({ name: 'EventList' }); // Redirection vers la page des événements
      } else {
        alert('Veuillez entrer un email');
      }
    };

    const createEvent = () => {
      router.push({ name: 'Step1' }); // Redirection vers le formulaire de création d'événement
    };

    const  showEmailInput = () => {
      const timelineShowInputEmail = gsap.timeline();

      timelineShowInputEmail
        .to(containerEmail.value,{
          y: '-100dvh',
          duration: 1,
          ease: 'power4.out',
        })
    }

    const  hideEmailInput = () => {
      const timelineHideInputEmail = gsap.timeline();

      timelineHideInputEmail
        .to(containerEmail.value,{
          y: '100dvh',
          duration: 1,
          ease: 'power2.out',
        })
    }

    const timelineSlider = gsap.timeline({ repeat: -1 }); 
    const timelineGradient = gsap.timeline({ repeat: -1 }); 
    const timelineShadow = gsap.timeline({ repeat: -1 }); 

    onMounted(() => {
      document.body.style.overflow = 'hidden';    
  
      timelineSlider
        .to(slider.value, { 
          y: () => -slider.value.offsetHeight + 90 + (slider.value.offsetHeight/6) * 1, 
          duration: 1,
          ease: 'bounce.out',
          delay: 1,
        })
       .to(slider.value, { 
          y: () => -slider.value.offsetHeight + 90 + (slider.value.offsetHeight/6) * 2, 
          duration: 1,
          ease: 'bounce.out',
          delay: 1,
        })
        .to(slider.value, { 
          y: () => -slider.value.offsetHeight + 90 + (slider.value.offsetHeight/6) * 3, 
          duration: 1,
          ease: 'bounce.out',
          delay: 1,
        })
        .to(slider.value, { 
          y: () => -slider.value.offsetHeight + 90 + (slider.value.offsetHeight/6) * 4, 
          duration: 1,
          ease: 'bounce.out',
          delay: 1,
        })
        .to(slider.value, { 
          y: () => -slider.value.offsetHeight + 90 + (slider.value.offsetHeight/6) * 5, 
          duration: 1,
          ease: 'bounce.out',
          delay: 1,
        })

      gsap.set(gradient.value, {
        background: 'radial-gradient(ellipse 200% 120% at top center, #E8F599 30%, #fff 50%)',
        opacity: 0.7,  // Valeur d'opacité initiale
      });    
  
      timelineGradient
        .to(gradient.value, { 
          background: 'radial-gradient(ellipse 200% 120% at top center, #A6D3EE 30%, #fff 50%)', 
          opacity: 0.5, 
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
        .to(gradient.value, { 
          background: 'radial-gradient(ellipse 200% 120% at top center, #FFF7D0 30%, #fff 50%)',
          opacity: 1,
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
        .to(gradient.value, { 
          background: 'radial-gradient(ellipse 200% 120% at top center, #AE92E466 30%, #fff 50%)', 
          opacity: 0.4,
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
        .to(gradient.value, { 
          background: 'radial-gradient(ellipse 200% 120% at top center, #FFE4B7 30%, #fff 50%)', 
          opacity: 1,
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
        .to(gradient.value, { 
          background: 'radial-gradient(ellipse 200% 120% at top center, #E8F599 30%, #fff 50%)',
          opacity: 0.7,
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })

      gsap.set(containerEmail.value, {
        boxShadow: '0px 2px 35px 25px rgba(232, 245, 153, 0.7)',
      });    
  
      timelineShadow
        .to(containerEmail.value, {
          boxShadow: '0px 2px 35px 25px rgba(186, 229, 255, 0.5)',
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
        .to(containerEmail.value, { 
          boxShadow: '0px 2px 35px 25px rgba(255, 240, 182)',
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
        .to(containerEmail.value, {  
          boxShadow: '0px 2px 35px 25px rgba(208, 183, 255, 0.4)',
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
        .to(containerEmail.value, {  
          boxShadow: '0px 2px 35px 25px rgba(255, 228, 183)',
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
        .to(containerEmail.value, { 
          boxShadow: '0px 2px 35px 25px rgba(232, 245, 153, 0.7)',
          duration: 1,
          ease: "power1.out",
          delay: 1,
        })
    });

    onBeforeUnmount(() => {
      document.body.style.overflow = '';
      timelineSlider.kill();
      timelineGradient.kill();
      timelineShadow.kill();
    });
    
</script> 
  
<style scoped>
  /* Styles mobile-first */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .home-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: 0;
    overflow: hidden;
    height: 100%;
    width: 100%;
  }

  .logo {
    position: fixed;
    top: 16px;
  }

  .gradient {
    position: fixed;
    top: 0px;
    width: 100%;
    height: 40dvh;
    background: radial-gradient(ellipse 200% 120% at top center, #e8f599 30%, #fff 50%);
    z-index: -1;
  }
  
  .container-title {
    height: 100px;
    transform: translateY(-20vw);
    text-align: center;
    width: 100%;
  }

  .container-title h1 {
    font-weight: 500;
    font-size: 32px;
    line-height: 32px;
    margin: 0px;
    font-family: 'General Sans', sans-serif;
  }

  .line-carousel{
    position: relative;
    height: 48px;
  }

  .line-carousel h1 {
    display: inline-block;
  }

  .line-carousel .hiddenText {
    position: absolute;
    height: 80px;
    width: 100%;
    overflow: hidden;
    display: flex;
    justify-content: center;
  }

  .line-carousel .pastille-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: absolute;
    transform: translateY(calc(-100% + 90px)); /*74 taille pastille*/
    will-change: transform;
  }

  .line-carousel .pastille {
    border-radius: 50px;
    margin: 15px 0;
    padding: 5px 15px;
    text-align: center;
    font-size: 32px;
    font-weight: 500;
    flex-shrink: 0;
    white-space: nowrap;
    font-family: 'General sans';
  }

  .pastille:nth-child(1){ 
    background-color: rgba(232, 245, 153, 0.3); 
    border: 1px solid rgba(201, 213, 124, 0.4); 
    color: rgba(109, 119, 54, 1);
  }
  .pastille:nth-child(6){ 
    background-color: rgba(232, 245, 153, 0.3); 
    border: 1px solid rgba(201, 213, 124, 0.4); 
    color: rgba(109, 119, 54, 1);
  }
  .pastille:nth-child(2) { 
    background-color: rgba(255, 228, 183, 0.3);
    border: 1px solid rgba(221, 188, 134, 0.4);
    color: rgba(119, 54, 55, 1);
  }
  .pastille:nth-child(3) { 
    background-color: rgba(208, 183, 255, 0.3); 
    border: 1px solid rgba(174, 146, 228, 0.4);
    color: rgba(95, 54, 119, 1);
  }
  .pastille:nth-child(4) { 
    background-color: rgba(255, 240, 182, 0.3);
    border: 1px solid rgba(235, 219, 160, 0.4);
    color: rgba(119, 95, 54, 1);
  }
  .pastille:nth-child(5) { 
    background-color: rgba(186, 229, 255, 0.3);
    border: 1px solid rgba(166, 211, 238, 0.4);
    color: rgba(54, 87, 119, 1);
  }

  .indication {
    font-family: 'BookmanJFPro Regular', sans-serif;
    font-style: italic;
    font-weight: 400;
    font-size: 2dvh;
    margin: 14px;
    transform: translateY(-3dvh)
  }
  
  .btn-create-event {
    background-color: #000000;
    color: #ffffff;
    font-family: 'General sans';
    border-radius: 4px;
    font-weight: 400;
    font-size: 14px;
    padding: 0px;
    margin: 0;
    border: none;
    width: 90%;
    height: 7dvh;
    cursor: pointer
  }

  .create-event-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: absolute;
    bottom: 0;
  }

  .create-event-container a {
    text-decoration: underline;
    cursor: pointer;
    color: #000000;
    font-size: 14px;
    font-weight: 500;
    line-height: 26px;
    font-family: 'General sans';
    margin: 14px;
  }
  
  .email-retrieve-container {
    position: absolute;
    bottom: -100dvh;
    width: 100%;
    height: 25dvh;
    display: flex;
    align-items: center;
    flex-direction: column;
    background-color: #ffffff;
    border-top: 1px solid rgba(0,0,0,0.1);
    border-radius: 24px 24px 0 0;
    box-shadow: 0px 2px 35px 25px rgba(232, 245, 153,0.3);
  }

  .email-retrieve-container .exit{
    background-color: transparent;
    border: none;
    width: 24px;
    height: 24px;
    cursor: pointer;
    align-self: end;
    margin-right: 3dvh;
    margin-top: 5px;
  }

  .email-retrieve-container p {
    font-family: 'General sans';
    font-weight: 500;
    font-size: 16px;
    text-align: center;
    width: 60%;
    flex: 1;
    margin: 0;
    display: flex;
    align-items: center;
  }
  
  .input-container {
    flex: 1;
    display: inline-block;
    width: 85%;
    display: flex;
    align-items: center;
    justify-content: center
  }
  
  .email-input {
    position: relative;
    padding: 0.8rem;
    font-size: 1rem;
    border: 1px solid #EBEDF2;
    border-radius: 4px;
    width: 100%;
    padding: 15px;
  }

  .email-input:focus-visible {
    outline: 1px solid #A8ACB7;
  }
  
  .retrieve-events-button {
    position: absolute;
    background-color: black;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    width: 44px;
    height: 36px;
    right: 9%;
  }

  .retrieve-events-button > svg {
    transform: rotate(180deg);
    scale: 0.7;
  }
  
</style>
  
